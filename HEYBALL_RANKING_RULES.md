# 🎱 Joy Billiards NZ Heyball 段位赛规则 v2.0

## Joy Billiards NZ Heyball Ranking System v2.0

---

## 一、赛事目标 / Purpose

**中文：**
- 建立长期稳定的比赛体系，吸引固定参赛人群
- 通过积分与段位晋升，提升参与感与荣誉感
- 促进球房社区活跃度和玩家技能提升

**English:**
- Establish a long-term stable competition system to attract regular participants
- Enhance engagement and sense of achievement through points and ranking promotions
- Promote venue community activity and player skill development

---

## 二、段位设计 / Ranking Levels

| 中文段位 | English Rank | 徽章 | 积分范围 Points |
|---------|-------------|------|----------------|
| 初学 | Beginner | ⚪ | 0–14 |
| 进阶 | Intermediate | 🔸 | 15–39 |
| 高阶 | Advance | 🔺 | 40–79 |
| 黄金 | Expert | 🔶 | 80–149 |
| 精英 | Elite | 🔷 | 150–249 |
| 大师 | Master | ⭐ | 250–349 |
| 特级大师 | Grand Master | 🌟 | 350–449 |
| 职业段 | Pro Level | 💎 | 450–549 |
| 殿堂 | Hall of Fame | 👑 | 550+ |

---

## 三、积分系统 / Point System

### 周赛积分 / Weekly Match Points

| 成绩 Result | 积分 Points |
|------------|------------|
| 🏆 Champion 冠军 | +20 |
| 🥈 Runner-up 亚军 | +15 |
| 🎯 Top 4 四强 | +10 |
| ⚔️ Top 8 八强 | +6 |
| ✅ Participation 参赛 | +3 |

### 晋升与降级 / Promotion & Demotion

- **晋升 Promotion：** 积分达到门槛自动晋升
- **降级 Demotion：** 积分跌回下限自动降级

### 不活跃惩罚 / Inactivity Penalty

- 连续 **4 周未参赛** → **-20 分**
- Consecutive **4 weeks** without participation → **-20 points**

### 年度清零 / Annual Reset

**机制 Mechanism:**
- 每年 12 月最后一场比赛后积分清零
- Points reset after the last match in December
- 段位身份保留，新赛季从该段位下限积分起步
- Ranking level preserved, new season starts at that level's minimum points

**示例 Example:**
- 你是 Master (大师) 段位，有 320 分
- 年度清零后：仍是 Master，但积分重置为 250 分（Master 最低分）
- You're Master rank with 320 points
- After annual reset: Still Master, but points reset to 250 (Master minimum)

---

## 四、让局规则 / Handicap Rules

| 段位差 Rank Gap | 让局 Frames |
|----------------|------------|
| 0–1 levels | 0 frames |
| 2–3 levels | 1 frame |
| 4–5 levels | 2 frames |
| 6+ levels | 3 frames |

**说明 Explanation:**
- Race to 5 的比赛，让 3 局意味着比分从 0:3 开局
- In a Race to 5 match, 3 frames handicap means starting at 0:3

---

## 五、积分修正规则 / Adjustment Rules

### 基础规则 / Base Rules

1. **低段位胜高段位：** 积分翻倍（×2）
   - Lower rank beats higher rank: Points doubled (×2)

2. **高段位胜低段位：** 积分减半（÷2，向上取整）
   - Higher rank beats lower rank: Points halved (÷2, round up)

3. **同段位对阵：** 正常积分
   - Same rank: Normal points

---

## 六、对阵示例 / Match Examples

### 示例 1 / Example 1

**对阵 Match:**
- Master (大师) vs Intermediate (进阶)
- 段位差 = 6 levels

**让局 Handicap:**
- Race to 5, Master 让 3 局
- Starting score: 0:3

**积分 Points:**
- **Intermediate 胜：** 20 分 (10×2 翻倍)
- **Master 胜：** 5 分 (10÷2 减半)

---

### 示例 2 / Example 2

**对阵 Match:**
- Expert (黄金) vs Advance (高阶)
- 段位差 = 2 levels

**让局 Handicap:**
- Race to 5, Expert 让 1 局
- Starting score: 0:1

**积分 Points:**
- **Advance 胜：** 20 分 (10×2 翻倍)
- **Expert 胜：** 5 分 (10÷2 减半)

---

### 示例 3 / Example 3

**对阵 Match:**
- Elite (精英) vs Elite (精英)
- 段位差 = 0 (相同段位)

**让局 Handicap:**
- Race to 5, 无让局
- Starting score: 0:0

**积分 Points:**
- **任意一方胜：** 10 分（正常积分）

---

## 七、月榜与年榜 / Monthly & Annual Rankings

### 📅 月榜 Monthly Rankings

- **积分计算：** 每月累积的周赛积分
- **重置时间：** 每月1日清零
- **奖励：** 月冠军获得特别奖励

### 🏅 年榜 Annual Rankings

- **积分计算：** 全年累积的周赛积分
- **重置时间：** 每年12月31日
- **段位保留：** 重置后保留段位，从该段位最低分起步
- **奖励：** 年度总冠军获得殿堂荣誉

---

## 八、段位保底机制 / Rank Protection

### 年度重置保底分 / Annual Reset Base Points

| 段位 Rank | 重置后保底分 Reset Base |
|----------|---------------------|
| 殿堂 Hall of Fame | 550 points |
| 职业段 Pro Level | 450 points |
| 特级大师 Grand Master | 350 points |
| 大师 Master | 250 points |
| 精英 Elite | 150 points |
| 黄金 Expert | 80 points |
| 高阶 Advance | 40 points |
| 进阶 Intermediate | 15 points |
| 初学 Beginner | 0 points |

**说明：** 年度清零时，你的段位不变，但积分重置为该段位的最低分。这样可以保证段位的含金量，同时给所有人公平的新赛季起点。

**Explanation:** During annual reset, your rank level remains the same, but points reset to the minimum for that rank. This ensures rank value while giving everyone a fair start for the new season.

---

## 九、周赛流程 / Weekly Tournament Flow

### 赛前 Before Match

1. **注册参赛：** 玩家在系统中报名
2. **系统分组：** 根据段位自动分组配对
3. **计算让局：** 系统自动计算让局数

### 赛中 During Match

1. **对局进行：** Race to 5（先到5局胜）
2. **应用让局：** 低段位选手从让局分开始
3. **记录比分：** 管理员实时更新比分

### 赛后 After Match

1. **录入成绩：** 管理员录入最终排名
2. **自动计分：** 系统自动计算积分
3. **应用修正：** 根据段位差调整积分
4. **更新段位：** 积分达标自动晋升
5. **更新榜单：** 实时更新三榜（当前/月/年）

---

## 十、特殊规则 / Special Rules

### 同分处理 / Tie-breaking

当两名玩家积分相同时，排名依据：
1. 胜场数（Wins）
2. 胜率（Win Rate）
3. 周赛参与次数（Weekly Matches）
4. 注册时间（Earlier registration）

### 保级制度 / Relegation Protection

- 新晋升玩家有 **2 周保护期**
- 保护期内积分不会降级
- Newly promoted players have **2 weeks protection**
- No demotion during protection period

---

## 十一、实施细节 / Implementation

### 数据库表 / Database Tables

#### 1. users (扩展字段)
```
- ranking_points: 当前赛季积分
- ranking_level: 当前段位
- monthly_points: 月榜积分
- annual_points: 年榜积分
- weekly_matches_played: 周赛参与次数
- last_match_date: 最后比赛日期
- season_year: 赛季年份
```

#### 2. weekly_tournaments
```
- week_number: 周次
- year: 年份
- tournament_date: 比赛日期
- champion_id: 冠军
- runner_up_id: 亚军
- status: 状态
```

#### 3. weekly_participants
```
- weekly_tournament_id: 周赛ID
- user_id: 用户ID
- final_position: 最终名次
- points_earned: 获得积分
```

---

## 十二、管理员功能 / Admin Functions

### 周赛管理 / Weekly Tournament Management

1. **创建周赛：** 设置周次、日期
2. **录入成绩：** 选择冠军、亚军等
3. **确认结果：** 自动分配积分
4. **查看历史：** 所有周赛记录

### 积分调整 / Points Adjustment

```sql
-- 手动调整积分
UPDATE users 
SET ranking_points = ranking_points + 20 
WHERE email = 'player@example.com';

-- 手动设置段位
UPDATE users 
SET ranking_level = 'master' 
WHERE email = 'player@example.com';
```

---

## 十三、排行榜功能 / Leaderboard Features

### ✅ 已实现功能

1. **领奖台展示：** Top 3 玩家特别展示
2. **完整排行：** 所有玩家排名
3. **三榜切换：** 当前/月/年
4. **段位说明：** 完整段位体系展示
5. **规则展示：** 积分和让局规则
6. **实时数据：** 自动更新排名

---

## 🎯 快速使用指南

### 查看排行榜

访问：http://localhost:3000/leaderboard

### 管理周赛（仅管理员）

访问：http://localhost:3000/weekly-tournament

### 查看个人段位

访问：http://localhost:3000/profile
查看你的段位徽章和积分

---

## 📊 当前排行榜

```
#1 👑 Max Meng - 殿堂 Hall of Fame (580分, 胜率84.9%)
#2 💎 Michael Chen - 职业段 Pro Level (475分, 胜率76.0%)
#3 ⭐ John Smith - 大师 Master (280分, 胜率65.1%)
#4 🔶 Sarah Johnson - 黄金 Expert (95分, 胜率45.5%)
#5 🔸 Emma Wilson - 进阶 Intermediate (22分, 胜率40.0%)
```

---

## 🎉 系统完成！

```
✅ 9级段位系统
✅ 自动段位计算
✅ 周赛积分管理
✅ 月榜 + 年榜
✅ 让局规则
✅ 积分修正机制
✅ 年度清零保底分
✅ 排行榜页面
✅ 周赛管理页面
✅ 中英文对照

状态：🟢 完全就绪！
```

---

**Heyball 段位赛系统已上线！** 🏆✨

*开始你的段位之旅吧！*

