<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Database Connection Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .result {
      background: white;
      padding: 20px;
      margin: 10px 0;
      border-radius: 8px;
      border-left: 4px solid #28a745;
    }
    .error {
      border-left-color: #dc3545;
      background: #fff5f5;
    }
    pre {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h1>ğŸ” Database Table Test</h1>
  <p>æµ‹è¯•å“ªä¸ªè¡¨åå¯ä»¥è®¿é—®</p>
  
  <div>
    <button onclick="testOldTable()">æµ‹è¯•æ—§è¡¨ (point_history)</button>
    <button onclick="testNewTable()">æµ‹è¯•æ–°è¡¨ (ranking_point_history)</button>
    <button onclick="testAllTables()">åˆ—å‡ºæ‰€æœ‰è¡¨</button>
  </div>
  
  <div id="results"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

    const supabaseUrl = 'https://qnwtqgdbgyqwpsdqvxfl.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFud3RxZ2RiZ3lxd3BzZHF2eGZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk5NjM1NDQsImV4cCI6MjA3NTUzOTU0NH0.3sujc8r9taASBUTdXUbCR-oJQcjKgXrLAafYc7k0SU4'
    
    window.supabase = createClient(supabaseUrl, supabaseKey)
    
    window.testOldTable = async function() {
      const resultsDiv = document.getElementById('results')
      try {
        const { data, error } = await window.supabase
          .from('point_history')
          .select('*')
          .limit(1)
        
        if (error) {
          resultsDiv.innerHTML += `<div class="result error">
            <h3>âŒ æ—§è¡¨ (point_history)</h3>
            <p><strong>é”™è¯¯ï¼š</strong> ${error.message}</p>
            <pre>${JSON.stringify(error, null, 2)}</pre>
          </div>`
        } else {
          resultsDiv.innerHTML += `<div class="result">
            <h3>âœ… æ—§è¡¨ (point_history) å­˜åœ¨</h3>
            <p>æ‰¾åˆ° ${data.length} æ¡è®°å½•</p>
          </div>`
        }
      } catch (err) {
        resultsDiv.innerHTML += `<div class="result error">
          <h3>âŒ å¼‚å¸¸</h3>
          <pre>${err.message}</pre>
        </div>`
      }
    }
    
    window.testNewTable = async function() {
      const resultsDiv = document.getElementById('results')
      try {
        const { data, error } = await window.supabase
          .from('ranking_point_history')
          .select('*')
          .limit(5)
        
        if (error) {
          resultsDiv.innerHTML += `<div class="result error">
            <h3>âŒ æ–°è¡¨ (ranking_point_history)</h3>
            <p><strong>é”™è¯¯ï¼š</strong> ${error.message}</p>
            <pre>${JSON.stringify(error, null, 2)}</pre>
          </div>`
        } else {
          resultsDiv.innerHTML += `<div class="result">
            <h3>âœ… æ–°è¡¨ (ranking_point_history) æ­£å¸¸</h3>
            <p>æ‰¾åˆ° ${data.length} æ¡è®°å½•</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          </div>`
        }
      } catch (err) {
        resultsDiv.innerHTML += `<div class="result error">
          <h3>âŒ å¼‚å¸¸</h3>
          <pre>${err.message}</pre>
        </div>`
      }
    }
    
    window.testAllTables = async function() {
      const resultsDiv = document.getElementById('results')
      
      const tables = [
        'users',
        'tournaments',
        'matches',
        'ranking_point_history',
        'loyalty_point_history',
        'point_history'
      ]
      
      resultsDiv.innerHTML = '<h3>ğŸ” æµ‹è¯•æ‰€æœ‰è¡¨...</h3>'
      
      for (const table of tables) {
        try {
          const { data, error, count } = await window.supabase
            .from(table)
            .select('*', { count: 'exact', head: true })
          
          if (error) {
            resultsDiv.innerHTML += `<div class="result error">
              <strong>âŒ ${table}:</strong> ${error.message}
            </div>`
          } else {
            resultsDiv.innerHTML += `<div class="result">
              <strong>âœ… ${table}:</strong> è¡¨å­˜åœ¨ (${count || 0} æ¡è®°å½•)
            </div>`
          }
        } catch (err) {
          resultsDiv.innerHTML += `<div class="result error">
            <strong>âŒ ${table}:</strong> ${err.message}
          </div>`
        }
      }
    }
  </script>
</body>
</html>

