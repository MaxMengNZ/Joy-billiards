# ğŸ† æ’è¡Œæ¦œç§¯åˆ†æ˜¾ç¤ºé”™è¯¯ä¿®å¤

**é—®é¢˜ï¼š** æ’è¡Œæ¦œæ˜¾ç¤ºäº† loyalty_pointsï¼ˆ22åˆ†ï¼‰ï¼Œè€Œä¸æ˜¯ ranking_points  
**åŸå› ï¼š** `public_users` è§†å›¾ç¼ºå°‘ `ranking_points` å­—æ®µ  
**çŠ¶æ€ï¼š** ğŸ”„ éœ€è¦æ‰§è¡Œ SQL ä¿®å¤

---

## ğŸ” é—®é¢˜åˆ†æ

### å‘ç°çš„é—®é¢˜ï¼š

**ç©å®¶ï¼š** Sayed Basir Hussaini  
**æ˜¾ç¤ºï¼š** 22 pts  
**å®é™…æƒ…å†µï¼š**
- `loyalty_points` = 22ï¼ˆæ¶ˆè´¹ç§¯åˆ†ï¼‰
- `ranking_points` = 0ï¼ˆæ®µä½ç§¯åˆ†ï¼‰

**é”™è¯¯åŸå› ï¼š**
æ’è¡Œæ¦œä» `public_users` è§†å›¾è·å–æ•°æ®ï¼Œä½†è¯¥è§†å›¾å¯èƒ½ç¼ºå°‘ `ranking_points` å­—æ®µï¼Œå¯¼è‡´ä»£ç å›é€€ä½¿ç”¨äº† `loyalty_points`ã€‚

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ç¬¬ 1 æ­¥ï¼šæ›´æ–° public_users è§†å›¾

æ‰“å¼€ Supabase SQL Editorï¼š
https://app.supabase.com/project/qnwtqgdbgyqwpsdqvxfl/sql/new

è¿è¡Œæ•´ä¸ª `ä¿®å¤public_usersè§†å›¾.sql` æ–‡ä»¶çš„å†…å®¹ï¼š

```sql
DROP VIEW IF EXISTS public_users CASCADE;

CREATE OR REPLACE VIEW public_users AS
SELECT 
    id,
    name,
    email,
    phone,
    wins,
    losses,
    skill_level,
    ranking_level,
    ranking_points,        -- âœ… å…³é”®ï¼æ®µä½ç§¯åˆ†
    loyalty_points,        -- âœ… æ¶ˆè´¹ç§¯åˆ†ï¼ˆä»…å‚è€ƒï¼‰
    membership_card_number,
    membership_level,
    membership_expires_at,
    break_and_run_count,
    is_active,
    last_match_date,
    created_at,
    updated_at
FROM users
WHERE is_active = true;

GRANT SELECT ON public_users TO anon, authenticated;
```

### ç¬¬ 2 æ­¥ï¼šéªŒè¯
è¿è¡Œè¿™ä¸ªæŸ¥è¯¢ç¡®è®¤ï¼š
```sql
SELECT 
  name,
  ranking_points,
  loyalty_points
FROM public_users
WHERE name LIKE '%Sayed%';
```

åº”è¯¥çœ‹åˆ°ï¼š
```
name                    ranking_points  loyalty_points
Sayed Basir Hussaini    0               22
```

### ç¬¬ 3 æ­¥ï¼šåˆ·æ–°é¡µé¢
åˆ·æ–°æ’è¡Œæ¦œé¡µé¢ï¼šhttp://localhost:3000/leaderboard

---

## ğŸ¯ é¢„æœŸç»“æœ

### ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰ï¼š
```
æ’è¡Œæ¦œæ˜¾ç¤ºï¼š
1. Sayed Basir Hussaini - 22 pts  âŒ (è¿™æ˜¯ loyalty_points)
```

### ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰ï¼š
```
æ’è¡Œæ¦œåº”è¯¥æ˜¯ç©ºçš„æˆ–åªæ˜¾ç¤ºæœ‰ ranking_points çš„ç©å®¶

å¦‚æœ Sayed çš„ ranking_points = 0ï¼Œä»–ä¸åº”è¯¥å‡ºç°åœ¨æ’è¡Œæ¦œä¸Š âœ…
```

---

## ğŸ’¡ ç§¯åˆ†ç³»ç»Ÿè¯´æ˜

### Ranking Pointsï¼ˆæ®µä½ç§¯åˆ†ï¼‰
- **ç”¨é€”ï¼š** æ’è¡Œæ¦œæ’åã€æ®µä½ç­‰çº§
- **æ¥æºï¼š** æ¯”èµ›æˆç»©
  - å† å†› +20
  - äºšå†› +15
  - å››å¼º +10
  - ç­‰ç­‰...
- **æ˜¾ç¤ºä½ç½®ï¼š** æ’è¡Œæ¦œã€ä¸ªäººèµ„æ–™
- **å½“å‰ Sayed çš„ ranking_pointsï¼š** 0

### Loyalty Pointsï¼ˆæ¶ˆè´¹ç§¯åˆ†ï¼‰
- **ç”¨é€”ï¼š** ä¼šå‘˜ç¦åˆ©ã€ç§¯åˆ†å…‘æ¢
- **æ¥æºï¼š** æ¶ˆè´¹é‡‘é¢ï¼ˆ1 NZD = points Ã— å€ç‡ï¼‰
- **æ˜¾ç¤ºä½ç½®ï¼š** ä¸ªäººèµ„æ–™ã€ä¼šå‘˜é¡µé¢
- **ä¸å½±å“ï¼š** æ’è¡Œæ¦œæ’å âœ…
- **å½“å‰ Sayed çš„ loyalty_pointsï¼š** 22

---

## ğŸ“‹ æµ‹è¯•éªŒè¯

### æ‰§è¡Œ SQL åï¼š

1. **åˆ·æ–°æ’è¡Œæ¦œ**
   - è®¿é—®ï¼šhttp://localhost:3000/leaderboard
   - Sayed åº”è¯¥æ¶ˆå¤±ï¼ˆå› ä¸º ranking_points = 0ï¼‰

2. **ç»™ Sayed æ·»åŠ æ®µä½ç§¯åˆ†**
   ```sql
   -- å‡è®¾ä»–èµ¢äº†æ¯”èµ›ï¼ŒåŠ 20åˆ†
   SELECT admin_add_ranking_points(
     (SELECT id FROM users WHERE name = 'Sayed Basir Hussaini'),
     20,
     'Tournament win',
     (SELECT id FROM users WHERE role = 'admin' LIMIT 1)
   );
   ```

3. **å†æ¬¡æŸ¥çœ‹æ’è¡Œæ¦œ**
   - ç°åœ¨åº”è¯¥æ˜¾ç¤ºï¼šSayed Basir Hussaini - 20 pts âœ…

4. **éªŒè¯ loyalty_points ä¸å½±å“æ’å**
   ```sql
   -- ç»™ä»–åŠ  100 æ¶ˆè´¹ç§¯åˆ†
   SELECT admin_add_loyalty_points(
     (SELECT id FROM users WHERE name = 'Sayed Basir Hussaini'),
     100.00,
     'Table rental',
     (SELECT id FROM users WHERE role = 'admin' LIMIT 1)
   );
   
   -- åˆ·æ–°æ’è¡Œæ¦œ â†’ æ’åä¸åº”è¯¥å˜åŒ– âœ…
   ```

---

## âš ï¸ é‡è¦æé†’

### æ’è¡Œæ¦œåªæ˜¾ç¤ºæœ‰æ®µä½ç§¯åˆ†çš„ç©å®¶

**è§„åˆ™ï¼š**
- `ranking_points > 0` â†’ æ˜¾ç¤ºåœ¨æ’è¡Œæ¦œ âœ…
- `ranking_points = 0` â†’ ä¸æ˜¾ç¤ºåœ¨æ’è¡Œæ¦œ âœ…
- `loyalty_points` â†’ ä¸å½±å“æ’è¡Œæ¦œæ˜¾ç¤º

### å¦‚æœä½ æƒ³è®©æŸä¸ªç©å®¶å‡ºç°åœ¨æ’è¡Œæ¦œï¼š

**å¿…é¡»ç»™ä»–æ·»åŠ  ranking_pointsï¼ˆæ®µä½ç§¯åˆ†ï¼‰ï¼š**
```sql
SELECT admin_add_ranking_points(
  'user_id',
  20,  -- æ®µä½ç§¯åˆ†
  'Reason',
  'admin_id'
);
```

**ä¸èƒ½åªæ·»åŠ  loyalty_pointsï¼ˆæ¶ˆè´¹ç§¯åˆ†ï¼‰ï¼**

---

## ğŸš€ ç«‹å³æ‰§è¡Œ

1. **æ‰“å¼€ Supabase SQL Editor**
2. **è¿è¡Œ `ä¿®å¤public_usersè§†å›¾.sql`**
3. **åˆ·æ–°æ’è¡Œæ¦œé¡µé¢**
4. **éªŒè¯ Sayed ä¸å†æ˜¾ç¤ºï¼ˆå› ä¸ºä»– ranking_points = 0ï¼‰**

---

**æ‰§è¡Œå®Œ SQL åå‘Šè¯‰æˆ‘ç»“æœï¼** ğŸ”§


