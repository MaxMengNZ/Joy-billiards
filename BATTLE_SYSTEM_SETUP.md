# âš”ï¸ Battle å¯¹æˆ˜ç³»ç»Ÿ - æœ¬åœ°æµ‹è¯•æŒ‡å—
# Battle System - Local Testing Guide

**ä¸­æ–‡ / Chinese** | **English**

---

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡ / Pre-Testing Setup

### 1. è¿è¡Œæ•°æ®åº“è¿ç§» / Run Database Migration

1. æ‰“å¼€ Supabase Dashboard SQL Editor / Open Supabase Dashboard SQL Editor
   ```
   https://app.supabase.com/project/qnwtqgdbgyqwpsdqvxfl/sql/new
   ```

2. å¤åˆ¶å¹¶æ‰§è¡Œè¿ç§»è„šæœ¬ / Copy and execute migration script
   - æ–‡ä»¶ï¼š`supabase/migrations/battle_system.sql`
   - å¤åˆ¶å…¨éƒ¨å†…å®¹åˆ° SQL Editor
   - ç‚¹å‡» **RUN** æ‰§è¡Œ

3. éªŒè¯è¡¨åˆ›å»ºæˆåŠŸ / Verify tables created
   - æ£€æŸ¥ `battle_challenges` è¡¨æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥ `battle_match_history` è¡¨æ˜¯å¦å­˜åœ¨
   - æ£€æŸ¥ `users` è¡¨æ˜¯å¦æ·»åŠ äº†æ–°å­—æ®µ

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤ / Testing Steps

### æµ‹è¯• 1: è®¿é—® Battle é¡µé¢ / Access Battle Page

1. å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨ / Start local server
   ```bash
   npm run dev
   ```

2. ç™»å½•è´¦æˆ· / Login to account
   - è®¿é—® `http://localhost:3001/login`
   - ä½¿ç”¨å·²æœ‰è´¦æˆ·ç™»å½•

3. è®¿é—® Battle é¡µé¢ / Access Battle page
   - ç‚¹å‡»å¯¼èˆªæ ä¸­çš„ **âš”ï¸ Battle** é“¾æ¥
   - æˆ–ç›´æ¥è®¿é—® `http://localhost:3001/battle`

4. éªŒè¯æ˜¾ç¤º / Verify display
   - âœ… åº”è¯¥çœ‹åˆ° Battle æ’è¡Œæ¦œï¼ˆåˆå§‹ä¸ºç©ºæˆ–æ˜¾ç¤ºé»˜è®¤Elo 1000çš„ç©å®¶ï¼‰
   - âœ… åº”è¯¥çœ‹åˆ° Pro/Student ç»„åˆ«åˆ‡æ¢æŒ‰é’®
   - âœ… åº”è¯¥çœ‹åˆ°"æˆ‘çš„æŒ‘æˆ˜"åŒºåŸŸï¼ˆå¦‚æœå·²ç™»å½•ï¼‰

---

### æµ‹è¯• 2: å‘èµ·æŒ‘æˆ˜ / Create Challenge

1. å‡†å¤‡ä¸¤ä¸ªæµ‹è¯•è´¦æˆ· / Prepare two test accounts
   - è´¦æˆ· Aï¼ˆæŒ‘æˆ˜è€…ï¼‰
   - è´¦æˆ· Bï¼ˆè¢«æŒ‘æˆ˜è€…ï¼‰

2. ä½¿ç”¨è´¦æˆ· A ç™»å½• / Login with Account A
   - è®¿é—® Battle é¡µé¢
   - åœ¨æ’è¡Œæ¦œä¸­æ‰¾åˆ°è´¦æˆ· B
   - ç‚¹å‡» **âš”ï¸ Challenge / æŒ‘æˆ˜** æŒ‰é’®

3. å¡«å†™æŒ‘æˆ˜ä¿¡æ¯ / Fill challenge form
   - Challenge Type: Battle / å¯¹æˆ˜
   - Race to Score: 5
   - ç‚¹å‡» **Send Challenge / å‘é€æŒ‘æˆ˜**

4. éªŒè¯æŒ‘æˆ˜åˆ›å»º / Verify challenge created
   - âœ… æŒ‘æˆ˜åº”è¯¥å‡ºç°åœ¨"æˆ‘çš„æŒ‘æˆ˜"çš„"Pending / å¾…å¤„ç†"æ ‡ç­¾
   - âœ… æ¨¡æ€æ¡†åº”è¯¥å…³é—­
   - âœ… ä¸åº”è¯¥æœ‰é”™è¯¯æç¤º

---

### æµ‹è¯• 3: æ¥å—æŒ‘æˆ˜ / Accept Challenge

1. ä½¿ç”¨è´¦æˆ· B ç™»å½• / Login with Account B
   - è®¿é—® Battle é¡µé¢
   - æŸ¥çœ‹"æˆ‘çš„æŒ‘æˆ˜"åŒºåŸŸ

2. æ¥å—æŒ‘æˆ˜ / Accept challenge
   - åº”è¯¥çœ‹åˆ°è´¦æˆ· A å‘èµ·çš„æŒ‘æˆ˜
   - ç‚¹å‡» **âœ… Accept / æ¥å—** æŒ‰é’®

3. éªŒè¯æŒ‘æˆ˜çŠ¶æ€ / Verify challenge status
   - âœ… æŒ‘æˆ˜çŠ¶æ€åº”è¯¥å˜ä¸º"Accepted / å·²æ¥å—"
   - âœ… æŒ‘æˆ˜åº”è¯¥å‡ºç°åœ¨"Active / è¿›è¡Œä¸­"æ ‡ç­¾

---

### æµ‹è¯• 4: å®ŒæˆæŒ‘æˆ˜ï¼ˆå½•å…¥ç»“æœï¼‰/ Complete Challenge (Enter Results)

1. ä½¿ç”¨ä»»æ„ä¸€æ–¹è´¦æˆ·ç™»å½• / Login with either account
   - è®¿é—® Battle é¡µé¢
   - æ‰¾åˆ°"Active / è¿›è¡Œä¸­"çš„æŒ‘æˆ˜

2. å½•å…¥ç»“æœ / Enter results
   - ç‚¹å‡» **ğŸ“ Enter Results / å½•å…¥ç»“æœ** æŒ‰é’®
   - é€‰æ‹©èƒœè€…
   - è¾“å…¥æ¯”åˆ†ï¼ˆä¾‹å¦‚ï¼š5-3ï¼‰
   - ç‚¹å‡» **Submit / æäº¤**

3. éªŒè¯ç»“æœ / Verify results
   - âœ… æŒ‘æˆ˜çŠ¶æ€åº”è¯¥å˜ä¸º"Completed / å·²å®Œæˆ"
   - âœ… Elo è¯„åˆ†åº”è¯¥è‡ªåŠ¨æ›´æ–°
   - âœ… Battle æ’è¡Œæ¦œåº”è¯¥æ›´æ–°
   - âœ… æŒ‘æˆ˜åº”è¯¥å‡ºç°åœ¨"History / å†å²"æ ‡ç­¾
   - âœ… èƒœè€…çš„ Elo åº”è¯¥å¢åŠ 
   - âœ… è´¥è€…çš„ Elo åº”è¯¥å‡å°‘

---

### æµ‹è¯• 5: éªŒè¯ç³»ç»Ÿç‹¬ç«‹æ€§ / Verify System Independence

1. æ£€æŸ¥å‘¨èµ›æ’è¡Œæ¦œ / Check Tournament Leaderboard
   - è®¿é—® `/leaderboard`
   - âœ… åº”è¯¥åªæ˜¾ç¤ºå‘¨èµ›ç§¯åˆ†ï¼ˆranking_pointsï¼‰
   - âœ… ä¸åº”è¯¥æ˜¾ç¤º Battle Elo

2. æ£€æŸ¥ Battle æ’è¡Œæ¦œ / Check Battle Leaderboard
   - è®¿é—® `/battle`
   - âœ… åº”è¯¥åªæ˜¾ç¤º Battle Eloï¼ˆelo_rating_pro/studentï¼‰
   - âœ… ä¸åº”è¯¥æ˜¾ç¤ºå‘¨èµ›ç§¯åˆ†

3. éªŒè¯æ•°æ®åˆ†ç¦» / Verify data separation
   - âœ… ä¸¤ä¸ªæ’è¡Œæ¦œçš„æ•°æ®åº”è¯¥å®Œå…¨ç‹¬ç«‹
   - âœ… ä¿®æ”¹ Battle Elo ä¸åº”è¯¥å½±å“å‘¨èµ›ç§¯åˆ†
   - âœ… ä¿®æ”¹å‘¨èµ›ç§¯åˆ†ä¸åº”è¯¥å½±å“ Battle Elo

---

## ğŸ› å¸¸è§é—®é¢˜ / Common Issues

### é—®é¢˜ 1: æ— æ³•çœ‹åˆ° Battle é¡µé¢ / Cannot see Battle page

**è§£å†³æ–¹æ¡ˆ / Solution:**
- æ£€æŸ¥æ˜¯å¦å·²ç™»å½•ï¼ˆBattle é¡µé¢éœ€è¦è®¤è¯ï¼‰
- æ£€æŸ¥è·¯ç”±æ˜¯å¦æ­£ç¡®é…ç½®
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### é—®é¢˜ 2: æŒ‘æˆ˜åˆ›å»ºå¤±è´¥ / Challenge creation fails

**è§£å†³æ–¹æ¡ˆ / Solution:**
- æ£€æŸ¥æ•°æ®åº“è¿ç§»æ˜¯å¦æˆåŠŸæ‰§è¡Œ
- æ£€æŸ¥ RLS ç­–ç•¥æ˜¯å¦æ­£ç¡®é…ç½®
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### é—®é¢˜ 3: Elo æ²¡æœ‰æ›´æ–° / Elo not updating

**è§£å†³æ–¹æ¡ˆ / Solution:**
- æ£€æŸ¥è§¦å‘å™¨æ˜¯å¦æ­£ç¡®åˆ›å»º
- æ£€æŸ¥ `update_battle_positions` å‡½æ•°æ˜¯å¦æ‰§è¡Œ
- æ£€æŸ¥æ•°æ®åº“æ—¥å¿—

### é—®é¢˜ 4: æ’è¡Œæ¦œä¸ºç©º / Leaderboard is empty

**è§£å†³æ–¹æ¡ˆ / Solution:**
- è¿™æ˜¯æ­£å¸¸çš„ï¼Œå¦‚æœè¿˜æ²¡æœ‰ç©å®¶å‚ä¸ Battle
- åˆ›å»ºå¹¶å®Œæˆä¸€äº›æŒ‘æˆ˜åï¼Œæ’è¡Œæ¦œä¼šæ˜¾ç¤ºæ•°æ®
- æ–°ç©å®¶é»˜è®¤ Elo ä¸º 1000

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å• / Testing Checklist

- [ ] æ•°æ®åº“è¿ç§»æˆåŠŸæ‰§è¡Œ
- [ ] å¯ä»¥è®¿é—® Battle é¡µé¢
- [ ] å¯ä»¥åˆ‡æ¢ Pro/Student ç»„åˆ«
- [ ] å¯ä»¥å‘èµ·æŒ‘æˆ˜
- [ ] å¯ä»¥æ¥å—æŒ‘æˆ˜
- [ ] å¯ä»¥æ‹’ç»æŒ‘æˆ˜
- [ ] å¯ä»¥å®ŒæˆæŒ‘æˆ˜å¹¶å½•å…¥ç»“æœ
- [ ] Elo è¯„åˆ†è‡ªåŠ¨æ›´æ–°
- [ ] Battle æ’è¡Œæ¦œè‡ªåŠ¨æ›´æ–°
- [ ] å‘¨èµ›æ’è¡Œæ¦œä¸å—å½±å“
- [ ] ä¸­è‹±åŒè¯­æ˜¾ç¤ºæ­£å¸¸
- [ ] ç§»åŠ¨ç«¯å“åº”å¼æ­£å¸¸

---

## ğŸ“ æµ‹è¯•æ•°æ®å»ºè®® / Test Data Suggestions

### åˆ›å»ºæµ‹è¯•æŒ‘æˆ˜æµç¨‹ / Create Test Challenge Flow

1. **å‡†å¤‡æ•°æ® / Prepare Data:**
   - è‡³å°‘ 2 ä¸ªæµ‹è¯•è´¦æˆ·
   - ç¡®ä¿è´¦æˆ·å·²æ¿€æ´»

2. **æµ‹è¯•åœºæ™¯ / Test Scenarios:**
   - åœºæ™¯ 1: Pro ç»„æŒ‘æˆ˜
   - åœºæ™¯ 2: Student ç»„æŒ‘æˆ˜
   - åœºæ™¯ 3: é«˜ Elo ç©å®¶æŒ‘æˆ˜ä½ Elo ç©å®¶ï¼ˆElo å˜åŒ–åº”è¯¥è¾ƒå°ï¼‰
   - åœºæ™¯ 4: ä½ Elo ç©å®¶æŒ‘æˆ˜é«˜ Elo ç©å®¶ï¼ˆElo å˜åŒ–åº”è¯¥è¾ƒå¤§ï¼‰

3. **éªŒè¯ Elo è®¡ç®— / Verify Elo Calculation:**
   - èƒœè€… Elo åº”è¯¥å¢åŠ 
   - è´¥è€… Elo åº”è¯¥å‡å°‘
   - Elo å˜åŒ–åº”è¯¥ç¬¦åˆ Elo ç®—æ³•ï¼ˆå®åŠ›å·®è·è¶Šå¤§ï¼Œå˜åŒ–è¶Šå°ï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥ / Next Steps

æµ‹è¯•é€šè¿‡åï¼š
1. âœ… æäº¤ä»£ç åˆ° GitHub
2. âœ… åœ¨ Supabase ç”Ÿäº§ç¯å¢ƒæ‰§è¡Œè¿ç§»
3. âœ… éƒ¨ç½²åˆ° Vercel
4. âœ… é€šçŸ¥ç”¨æˆ·æ–°åŠŸèƒ½ä¸Šçº¿

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ/ Need Help?

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. Supabase æ•°æ®åº“æ—¥å¿—
3. ç½‘ç»œè¯·æ±‚ï¼ˆNetwork tabï¼‰
4. RLS ç­–ç•¥é…ç½®
